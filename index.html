<!DOCTYPE html>
<html lang="en" dir="ltr">
   <head>
      <meta charset="utf-8">
      <title>Minesweeper</title>
   </head>
   <style>
      body {
         font-family: Tahoma, sans-serif;
      }
      input[type=number] {
         width: 40px;
      }
      .square {
         background-color: gray;
         display: inline-block;
         float: left;
         height: 20px;
         margin: 2px;
         width: 20px;
      }
      .grid-wrapper {
         border: 1px solid lightgreen;
         display: inline-block;
         padding: 15px;
      }
   </style>
   <body>
      <h1>Minesweeper using Canvas</h1>
      <h2>Options</h2>
      <h3>Grid Size</h3>
      <form>
         <label for="x"></label>
         <input id="x" type="number" value="9">
         x
         <label for="y"></label>
         <input id="y" type="number" value="9">
         <label for="numMines">Number of Mines</label>
         <input id="numMines" type="number" name="" value="10">
         <input type="button" name="" value="Submit" onclick="startGame()">
      </form>
      <div class="grid-wrapper">
         <div id="grid"></div>
      </div>
      <script>
         var grid = document.getElementById('grid');
         var gridArray;

         function startGame() {
            var x = getX();
            var y = getY();
            var numMines = getNumMines();
            clearGrid(grid);
            createGrid(grid, x, y, numMines);
            gridArray = createArray(gridArray, x, y, numMines);
            console.log(gridArray);
            gridArray = fillArray(gridArray);
         }
         function getX() {
            return Number(document.getElementById('x').value);
         }
         function getY() {
            return Number(document.getElementById('y').value);
         }
         function getNumMines() {
            return Number(document.getElementById('numMines').value);
         }
         function getGridElement() {
            return document.getElementById('grid');
         }

         function createGrid(grid, num_squares_x, num_squares_y, numMines) {

            //UI grid
            var width = 24 * num_squares_x;
            var height = 24 * num_squares_y;
            grid.style.width = width + "px";
            grid.style.height = height + "px";
            for(var i = 0; i < num_squares_y; i++) {
               for(var j = 0; j < num_squares_x; j++) {
                  var id = j.toString() + '-' + i.toString();
                  var square = createSquare(id);
                  grid.appendChild(square);
               }
            }
         }
         function createSquare(id) {
            var square = document.createElement('div');
            square.className += ' square';
            square.id = id;
            return square;
         }
         function clearGrid(grid) {
            while (grid.firstChild) {
                grid.removeChild(grid.firstChild);
            }
         }
         function createArray(array, num_squares_x, num_squares_y, numMines) {
            //array grid
            array = populateMines(array, num_squares_x, num_squares_y, numMines);
            return array;
         }
         function populateMines(array, num_squares_x, num_squares_y, numMines) {
            array = Array(num_squares_y).fill(0).map(x => Array(num_squares_x).fill(0));
            for(var n = 0; n < numMines; ++n) {
               var x_random = Math.floor(Math.random() * num_squares_x);
               var y_random = Math.floor(Math.random() * num_squares_y);
               if (array[y_random][x_random] != "x") {
                  array[y_random][x_random] = "x";
               }
               else {
                  n = n - 1;
               }
            }
            return array;
         }
         function fillArray(array) {
            for (var y = 0; y < array.length; ++y) {
               for(var x = 0; x < array[0].length; ++x) {
                  array[y][x] = getNumMinesNearby(array, x, y);
                  console.log(x, y, array[y][x]);
               }
            }
            return array;
         }
         function getNumMinesNearby(array, x, y) {
            if (array[y][x] === "x") {
               return "x";
            }
            //array[y][x]
            var array_max_y = array.length;
            var array_max_x = 0;
            if (array_max_y > 0) {
               array_max_x = array[0].length;
            }
            var numMinesNearby = 0;
            //array = [0, 0, 0, 0],
            //        [x, 0, 0, 0],
            //        [0, 0 ,0, 0]
            for(var i = -1; i < 2; ++i) {
               for(var j = -1; j < 2; ++j) {
                  //[-1][-1]
                  //
                  if(x + j >= 0 && x + j < array_max_x) {
                     if(y + i >= 0 && y + i < array_max_y) {
                        if (array[y + i][x + j] === "x") {
                           numMinesNearby++;
                        }
                     }
                  }
               }
            }
            return numMinesNearby;
         }

      </script>
   </body>
</html>
